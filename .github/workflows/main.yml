
name: Summarize Code Changes (Windows, PowerShell, System Python 3.11)

on:
  push:
    branches: ["**"]
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write

env:
  SUMMARY_DIR: ".changes"
  OLLAMA_ENDPOINT: "http://127.0.0.1:11434"
  OLLAMA_MODEL: "qwen2.5-coder:7b"
  OLLAMA_TIMEOUT_PER_FILE: "120"
  OLLAMA_TIMEOUT_OVERALL: "600"
  OVERALL_BATCH_SIZE: "20"
  OLLAMA_PATH: 'C:\Users\acc-techvi\AppData\Local\Programs\Ollama\ollama.exe'

jobs:
  summarize:
    runs-on: self-hosted
    defaults:
      run:
        shell: powershell
    steps:
    - name: Checkout
      uses: actions/checkout@v4
      with:
        fetch-depth: 0
        clean: false
    - name: Hard reset workspace to match event commit
      shell: powershell
      run: |
        git fetch --all --prune
        git checkout -f "${{ github.ref }}"
        git reset --hard "${{ github.sha }}"
        git clean -ffdx
    